<center>请求</center>





[toc]









## 请求

> `请求对象(Request)` 是完全基于 [PSR-7](https://www.php-fig.org/psr/psr-7/) 标准实现的，由 [hyperf/http-message](https://github.com/hyperf/http-message) 组件提供实现支持。



该组件完全独立，适用于任何一个框架项目。

```bash
composer require hyperf/http-message
```

> 实列

```shell
use Hyperf\HttpServer\Annotation\Controller;
use Hyperf\HttpServer\Annotation\RequestMapping;
use Hyperf\HttpServer\Contract\RequestInterface;
use Hyperf\HttpServer\Contract\ResponseInterface;

#[Controller]
class UserController extends AbstractController
{
    // 获取路由id  http://127.0.0.1:9501/user/2
    #[RequestMapping(path: "/user/{id:\d+}", methods: "get")]
    public function getId(RequestInterface $request, int $id, ResponseInterface $response)
    {
        
        return $this->response->json(["code"  => 200, 'id' => $id]);
    }
}

```





### 2. 请求方法

> 常用方法

```php
# 1. 请求路径 http://domain.com/foo/bar?baz=1，那么 path() 将会返回 foo/bar：
$uri = $request->path();

# 2. 使用 url() 或 fullUrl() 方法去获取传入请求的完整 URL。
// 没有查询参数
$url = $request->url();
// 带上查询参数
$url = $request->fullUrl();


# 3. getMethod() 方法将返回 HTTP 的请求方法。
$method = $request->getMethod();

if ($request->isMethod('post')) {
    // ...
}
```



### 3. 获取输入

> 获取输入 如果请求的 `Body` 数据格式是 `JSON`

```shell
# 1. 全部输入
$all = $request->all();

# 2. 获取指定值
$name = $request->input('name');
$name = $request->input('name', 'Hyperf');

# 3. 查询字符串获取输入
$name = $request->query();

# 4. 获取json输入
$name = $request->input('user.name', 'Hyperf');


# 5. cookie
$cookies = $request->getCookieParams();
```

```shell
# 获取文件
# 存在则返回一个 Hyperf\HttpMessage\Upload\UploadedFile 对象，不存在则返回 null
$file = $request->file('photo');

# 检查文件是否存在
if ($request->hasFile('photo')) {
    // ...
}

# 验证成功上传
if ($request->file('photo')->isValid()) {
    // ...
}

# 扩展名
// 该路径为上传文件的临时路径
$path = $request->file('photo')->getPath();

// 由于 Swoole 上传文件的 tmp_name 并没有保持文件原名，所以这个方法已重写为获取原文件名的后缀名
$extension = $request->file('photo')->getExtension();


# 储存
$file = $request->file('photo');
$file->moveTo('/foo/bar.jpg');

// 通过 isMoved(): bool 方法判断方法是否已移动
if ($file->isMoved()) {
    // ...
}
```

