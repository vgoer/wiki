<center>日志</center>





[toc]









## 日志

> `hyperf/logger` 组件是基于 [psr/logger](https://github.com/php-fig/log) 实现的，默认使用 [monolog/monolog](https://github.com/Seldaek/monolog) 作为驱动，在 `hyperf-skeleton` 项目内默认提供了一些日志配置，默认使用 `Monolog\Handler\StreamHandler`, 由于 `Swoole` 已经对 `fopen`, `fwrite` 等函数进行了协程化处理，所以只要不将 `useLocking` 参数设置为 `true`，就是协程安全的。





### 1. 安装

```shell
composer require hyperf/logger
```





## [配置](https://hyperf.wiki/3.1/#/zh-cn/logger?id=配置)

在 `hyperf-skeleton` 项目内默认提供了一些日志配置，默认情况下，日志的配置文件为 `config/autoload/logger.php` ，示例如下：

```php
<?php

return [
    'default' => [
        'handler' => [
            'class' => \Monolog\Handler\StreamHandler::class,
            'constructor' => [
                'stream' => BASE_PATH . '/runtime/logs/'.date('Y-m-d').'.log',
                'level' => \Monolog\Level::Debug,
            ],
        ],
        'formatter' => [
            'class' => \Monolog\Formatter\LineFormatter::class,
            'constructor' => [
                'format' => null,
                'dateFormat' => null,
                'allowInlineLineBreaks' => true,
            ]
        ],
    ],
];
```



## [使用](https://hyperf.wiki/3.1/#/zh-cn/logger?id=使用)

```php
<?php

declare(strict_types=1);

namespace App\Service;

use Psr\Log\LoggerInterface;
use Hyperf\Logger\LoggerFactory;

class LogService
{

    protected LoggerInterface $logger;

    public function __construct(LoggerFactory $loggerFactory)
    {
        // 第一个参数对应日志的 name, 第二个参数对应 config/autoload/logger.php 内的 key
        $this->logger = $loggerFactory->get('log', 'default');
    }

    public function logMessage(string $message)
    {
        $this->logger->info($message);
    }
}

```

> 使用

```php
    // 注入
    #[Inject]
    protected LogService $logService;

    public function getUserInfo(RequestInterface $request, ResponseInterface $response) : Psr7ResponseInterface
    {
        $data = $request->all();
        $userInfo = $this->userService->getUserInfo((int)$data["id"]);

        $this->logService->logMessage("getUserInfo: ".$userInfo);

        return $response->json(["code" => 200, "message" =>  "yes", "data" => $userInfo]);
    }
```

> 牛： 日志

```php
[2025-05-19 14:25:47] sql.INFO: [6.61] select * from `users` where `id` = '2' limit 1 [] []
[2025-05-19 14:25:47] log.INFO: getUserInfo: {"id":2,"name":"aaaa","email":"aaa","password":"10","created_at":"2025-05-19 13:55:33","updated_at":"2025-05-19 13:55:33"} [] []

```

